<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§›ì§‘ ë“±ë¡</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=84e642681736cd4be8ba93a1003f4dcc&libraries=services"></script>
</head>
<body>
<header style="padding: 20px;">
  <a th:href="@{/main}" style="text-decoration: none; font-size: 24px; font-weight: bold; color: #6a1b9a;">
    ğŸ½ï¸ ë§›ì§‘ ì¶”ì²œ
  </a>

  <div class="user-info" style="float: right;">
    <span th:if="${#authentication.principal != 'anonymousUser'}">
      ğŸ‘¤ <span th:text="${#authentication.principal.username}">ë¡œê·¸ì¸ ì‚¬ìš©ì</span>
      <a th:href="@{/logout}" class="login-btn">ë¡œê·¸ì•„ì›ƒ</a> <!-- ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì ìš© -->
    </span>
    <span th:if="${#authentication.principal == 'anonymousUser'}">
      <a th:href="@{/login}" class="login-btn">ë¡œê·¸ì¸</a> <!-- ë¡œê·¸ì¸ë„ ë™ì¼í•˜ê²Œ -->
    </span>
  </div>
</header>

<div class="form-container">
    <h2>ğŸ“Œ ë§›ì§‘ ë“±ë¡í•˜ê¸°</h2>
    <form id="restaurantForm" th:action="@{/recommend/write}" th:object="${restaurant}" method="post">
        <label>ì´ë¦„</label>
        <input type="text" th:field="*{placeName}" required />

        <label>ì£¼ì†Œ</label>
        <input type="text" th:field="*{addressName}" id="addressInput" required />

        <label>ì „í™”ë²ˆí˜¸</label>
        <input type="text" th:field="*{phone}" />

        <label>ì¹´í…Œê³ ë¦¬</label>
        <input type="text" th:field="*{category}" />

        <label>ì„¤ëª…</label>
        <textarea th:field="*{description}" rows="4"></textarea>

        <label>ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL</label>
        <input type="text" th:field="*{imageUrl}" />

        <!-- ì¢Œí‘œ íˆë“  í•„ë“œ -->
        <input type="hidden" th:field="*{longitude}" id="xCoord" />
        <input type="hidden" th:field="*{latitude}" id="yCoord" />

        <button type="submit">ë“±ë¡</button>
    </form>
</div>

<script>
    document.getElementById("restaurantForm").addEventListener("submit", function (event) {
        event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë§‰ìŒ

        var geocoder = new kakao.maps.services.Geocoder();
        var address = document.getElementById("addressInput").value;

        geocoder.addressSearch(address, function (result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                document.getElementById("xCoord").value = result[0].x;
                document.getElementById("yCoord").value = result[0].y;
                document.getElementById("restaurantForm").submit(); // ì¢Œí‘œ ì…‹íŒ… í›„ ì œì¶œ
            } else {
                alert("ì£¼ì†Œë¡œ ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        });
    });
</script>
</body>
</html>
